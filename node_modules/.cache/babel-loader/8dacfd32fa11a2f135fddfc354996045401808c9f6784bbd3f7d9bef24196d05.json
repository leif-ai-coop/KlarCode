{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback, useEffect } from 'react';\nimport { searchICDCodes, searchOPSCodes, getCurrentYear, loadICDData, loadOPSData } from '../services/dataService';\nimport { parseUserInput, analyzeCodeTypes } from '../utils/search';\n\n/**\r\n * Custom hook for medical code searching\r\n */\nconst useCodeSearch = () => {\n  _s();\n  const [searchInput, setSearchInput] = useState('');\n  const [searchResults, setSearchResults] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [errors, setErrors] = useState([]);\n  const [duplicatesRemoved, setDuplicatesRemoved] = useState(0);\n  const [selectedYear, setSelectedYear] = useState(getCurrentYear());\n  const [showMore, setShowMore] = useState({\n    kapitel: false,\n    gruppe: false,\n    dreisteller: false,\n    childCodes: false\n  });\n\n  // Initialize data loading\n  useEffect(() => {\n    const initializeData = async () => {\n      try {\n        setIsLoading(true);\n        // Preload data for the current year\n        await Promise.all([loadICDData(selectedYear), loadOPSData(selectedYear)]);\n      } catch (error) {\n        console.error('Error initializing data:', error);\n        setErrors(prev => [...prev, `Fehler beim Laden der Daten: ${error.message}`]);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    initializeData();\n  }, [selectedYear]);\n\n  /**\r\n   * Handle search input change\r\n   * @param {string} value - New search input value\r\n   */\n  const handleInputChange = useCallback(value => {\n    setSearchInput(value);\n  }, []);\n\n  /**\r\n   * Perform the search with the current input\r\n   * @param {string} [searchText] - Optional text to search for, uses searchInput state if not provided\r\n   */\n  const handleSearch = useCallback(async searchText => {\n    // Verwende searchText, wenn übergeben, sonst searchInput\n    const textToSearch = searchText || searchInput;\n    if (!textToSearch.trim()) {\n      return;\n    }\n\n    // Aktualisiere den State-Wert, falls ein neuer Wert übergeben wurde\n    if (searchText && searchText !== searchInput) {\n      setSearchInput(searchText);\n    }\n    setIsLoading(true);\n    setErrors([]);\n    setSearchResults([]);\n    setDuplicatesRemoved(0);\n    try {\n      // Verwende textToSearch statt searchInput und übergebe showMore.childCodes\n      const [icdResults, opsResults] = await Promise.all([searchICDCodes(textToSearch, selectedYear), searchOPSCodes(textToSearch, selectedYear, showMore.childCodes)]);\n\n      // Rest der Funktion bleibt gleich...\n      const combinedResults = [...icdResults.results, ...opsResults.results];\n      const combinedErrors = [...icdResults.errors, ...opsResults.errors];\n      const totalDuplicatesRemoved = icdResults.duplicatesRemoved + opsResults.duplicatesRemoved;\n      setSearchResults(combinedResults);\n      setErrors(combinedErrors);\n      setDuplicatesRemoved(totalDuplicatesRemoved);\n    } catch (error) {\n      console.error('Error during search:', error);\n      setErrors([`Fehler bei der Suche: ${error.message}`]);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [searchInput, selectedYear, showMore.childCodes]);\n\n  /**\r\n   * Handle year change\r\n   * @param {string} year - New year value\r\n   */\n  const handleYearChange = useCallback(year => {\n    setSelectedYear(year);\n  }, []);\n\n  /**\r\n   * Toggle showing additional info columns\r\n   * @param {string} field - Field to toggle (kapitel, gruppe, dreisteller, childCodes)\r\n   */\n  const toggleShowMore = useCallback(field => {\n    setShowMore(prev => ({\n      ...prev,\n      [field]: !prev[field]\n    }));\n\n    // If toggling childCodes, trigger a new search to update results\n    if (field === 'childCodes' && searchInput.trim()) {\n      // Use setTimeout to ensure state update completes first\n      setTimeout(() => {\n        handleSearch(searchInput);\n      }, 0);\n    }\n  }, [searchInput, handleSearch]);\n\n  /**\r\n   * Clear all search results and inputs\r\n   */\n  const handleClear = useCallback(() => {\n    setSearchInput('');\n    setSearchResults([]);\n    setErrors([]);\n    setDuplicatesRemoved(0);\n  }, []);\n  return {\n    searchInput,\n    searchResults,\n    isLoading,\n    errors,\n    duplicatesRemoved,\n    selectedYear,\n    showMore,\n    handleInputChange,\n    handleSearch,\n    handleYearChange,\n    toggleShowMore,\n    handleClear\n  };\n};\n_s(useCodeSearch, \"jYfYeYugMZL9wUxlMRdTKlIUsIY=\");\nexport default useCodeSearch;","map":{"version":3,"names":["useState","useCallback","useEffect","searchICDCodes","searchOPSCodes","getCurrentYear","loadICDData","loadOPSData","parseUserInput","analyzeCodeTypes","useCodeSearch","_s","searchInput","setSearchInput","searchResults","setSearchResults","isLoading","setIsLoading","errors","setErrors","duplicatesRemoved","setDuplicatesRemoved","selectedYear","setSelectedYear","showMore","setShowMore","kapitel","gruppe","dreisteller","childCodes","initializeData","Promise","all","error","console","prev","message","handleInputChange","value","handleSearch","searchText","textToSearch","trim","icdResults","opsResults","combinedResults","results","combinedErrors","totalDuplicatesRemoved","handleYearChange","year","toggleShowMore","field","setTimeout","handleClear"],"sources":["C:/Code/KlarCode/src/hooks/useCodeSearch.js"],"sourcesContent":["import { useState, useCallback, useEffect } from 'react';\r\nimport { searchICDCodes, searchOPSCodes, getCurrentYear, loadICDData, loadOPSData } from '../services/dataService';\r\nimport { parseUserInput, analyzeCodeTypes } from '../utils/search';\r\n\r\n/**\r\n * Custom hook for medical code searching\r\n */\r\nconst useCodeSearch = () => {\r\n  const [searchInput, setSearchInput] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [errors, setErrors] = useState([]);\r\n  const [duplicatesRemoved, setDuplicatesRemoved] = useState(0);\r\n  const [selectedYear, setSelectedYear] = useState(getCurrentYear());\r\n  const [showMore, setShowMore] = useState({\r\n    kapitel: false,\r\n    gruppe: false,\r\n    dreisteller: false,\r\n    childCodes: false\r\n  });\r\n  \r\n  // Initialize data loading\r\n  useEffect(() => {\r\n    const initializeData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        // Preload data for the current year\r\n        await Promise.all([\r\n          loadICDData(selectedYear),\r\n          loadOPSData(selectedYear)\r\n        ]);\r\n      } catch (error) {\r\n        console.error('Error initializing data:', error);\r\n        setErrors(prev => [...prev, `Fehler beim Laden der Daten: ${error.message}`]);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    initializeData();\r\n  }, [selectedYear]);\r\n  \r\n  /**\r\n   * Handle search input change\r\n   * @param {string} value - New search input value\r\n   */\r\n  const handleInputChange = useCallback((value) => {\r\n    setSearchInput(value);\r\n  }, []);\r\n  \r\n  /**\r\n   * Perform the search with the current input\r\n   * @param {string} [searchText] - Optional text to search for, uses searchInput state if not provided\r\n   */\r\n  const handleSearch = useCallback(async (searchText) => {\r\n    // Verwende searchText, wenn übergeben, sonst searchInput\r\n    const textToSearch = searchText || searchInput;\r\n    \r\n    if (!textToSearch.trim()) {\r\n      return;\r\n    }\r\n    \r\n    // Aktualisiere den State-Wert, falls ein neuer Wert übergeben wurde\r\n    if (searchText && searchText !== searchInput) {\r\n      setSearchInput(searchText);\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    setErrors([]);\r\n    setSearchResults([]);\r\n    setDuplicatesRemoved(0);\r\n    \r\n    try {\r\n      // Verwende textToSearch statt searchInput und übergebe showMore.childCodes\r\n      const [icdResults, opsResults] = await Promise.all([\r\n        searchICDCodes(textToSearch, selectedYear),\r\n        searchOPSCodes(textToSearch, selectedYear, showMore.childCodes)\r\n      ]);\r\n      \r\n      // Rest der Funktion bleibt gleich...\r\n      const combinedResults = [...icdResults.results, ...opsResults.results];\r\n      const combinedErrors = [...icdResults.errors, ...opsResults.errors];\r\n      const totalDuplicatesRemoved = icdResults.duplicatesRemoved + opsResults.duplicatesRemoved;\r\n      \r\n      setSearchResults(combinedResults);\r\n      setErrors(combinedErrors);\r\n      setDuplicatesRemoved(totalDuplicatesRemoved);\r\n    } catch (error) {\r\n      console.error('Error during search:', error);\r\n      setErrors([`Fehler bei der Suche: ${error.message}`]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [searchInput, selectedYear, showMore.childCodes]);\r\n  \r\n  /**\r\n   * Handle year change\r\n   * @param {string} year - New year value\r\n   */\r\n  const handleYearChange = useCallback((year) => {\r\n    setSelectedYear(year);\r\n  }, []);\r\n  \r\n  /**\r\n   * Toggle showing additional info columns\r\n   * @param {string} field - Field to toggle (kapitel, gruppe, dreisteller, childCodes)\r\n   */\r\n  const toggleShowMore = useCallback((field) => {\r\n    setShowMore(prev => ({\r\n      ...prev,\r\n      [field]: !prev[field]\r\n    }));\r\n    \r\n    // If toggling childCodes, trigger a new search to update results\r\n    if (field === 'childCodes' && searchInput.trim()) {\r\n      // Use setTimeout to ensure state update completes first\r\n      setTimeout(() => {\r\n        handleSearch(searchInput);\r\n      }, 0);\r\n    }\r\n  }, [searchInput, handleSearch]);\r\n  \r\n  /**\r\n   * Clear all search results and inputs\r\n   */\r\n  const handleClear = useCallback(() => {\r\n    setSearchInput('');\r\n    setSearchResults([]);\r\n    setErrors([]);\r\n    setDuplicatesRemoved(0);\r\n  }, []);\r\n  \r\n  return {\r\n    searchInput,\r\n    searchResults,\r\n    isLoading,\r\n    errors,\r\n    duplicatesRemoved,\r\n    selectedYear,\r\n    showMore,\r\n    handleInputChange,\r\n    handleSearch,\r\n    handleYearChange,\r\n    toggleShowMore,\r\n    handleClear,\r\n  };\r\n};\r\n\r\nexport default useCodeSearch; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}